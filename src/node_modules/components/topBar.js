import React, { Fragment, useContext, useEffect } from 'react'
import { Link, NavLink, Redirect } from 'react-router-dom'


import { CurrentUserContext } from 'contexts/currentUser'
import useLocalStorage from 'hooks/useLocalStorage'






const TopBar = () => {
    const [{ isLogged, isLoading, currentUserName, currentUser, isAuthorized }, dispatch] = useContext(CurrentUserContext)
    const [token, setToken] = useLocalStorage('token')
    if (isLoading) {
        return (
            <div>
                
            </div>
        )
    }

  
    const authenticaion = token ? '/' : '/authorized'
  
    return (
        <nav className='navbar navbar-light'>
            <div className='container'>
                <Link to={authenticaion} className='navbar-brand'>
                    Medium
                </Link>
                <ul className='nav navbar-nav pull-xs-right'>

                    {!isLogged &&  !token &&

                        <Fragment>
                            <li className='nav-item'>
                                <NavLink to={authenticaion} className='nav-link' exact >
                                    Home
                        </NavLink>
                            </li>
                            { isAuthorized &&
                            <Fragment><li className='nav-item'  >
                                <NavLink to='/login' className='nav-link' >
                                    Sign in
                        </NavLink>
                            </li>
                            <li className='nav-item' >
                                <NavLink to='/register' className='nav-link' >
                                    Sign up
                        </NavLink>
                            </li>
                            </Fragment> }

                        </Fragment>}
                    {isLogged &&
                        <Fragment>
                            <li className='nav-item'>
                                <NavLink to='/' className='nav-link' exact >
                                    Home
                        </NavLink>
                            </li>
                            <li className='nav-item'>
                                <NavLink to='/articles/new' className='nav-link' >
                                    <i className='ion-compose'></i>
                           &nbsp; New Post
                        </NavLink>
                            </li>
                            <li className='nav-item'>
                                <NavLink to='/settings' className='nav-link' >
                                    <i className='ion-gear-a'></i>
                           &nbsp; Settings
                        </NavLink>
                            </li>
                            <li className='nav-item'>
                                <NavLink to={`/profiles/${currentUserName}`}
                                    className='nav-link' >
                                    <img
                                        className='user-pic'
                                        src={currentUser.image}
                                        alt=''
                                    />
                           &nbsp; {currentUserName}
                                </NavLink>
                            </li>

                            <li className="nav-item">
                                <Link className="nav-link" to='/' onClick={() => {
                                    dispatch({ type: 'SET_UNAUTHORIZED' })
                                    setToken('')
                                    localStorage.removeItem('token')
                                    return <Redirect to='/authorized' />
                                }

                                }>{`Exit`}
                                </Link>
                            </li>



                        </Fragment>}





                </ul>
            </div>
        </nav>
    )


}


export default TopBar