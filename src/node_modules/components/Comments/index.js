import React, { useEffect } from "react";
import { Link } from 'react-router-dom'


import useFetch from 'hooks/useFetch'


const Comments = ({ fetchArticleResponseComments, doFetchComments, apiURL, isSuccessfull, setIsSuccesfull, setBody, setRename }) => {

    return (
        <div>
            {fetchArticleResponseComments && fetchArticleResponseComments.comments.map((comments, id) => {

                const [{ response: deleteArticleResponseComments }, doDeleteArticleComments] = useFetch(`${apiURL}/comments/${comments.id}`)


                const editArticleComments = async() => {
                       
                   await doDeleteArticleComments({
                        method: 'delete'
                    })
                    setRename('Rename Comment')
                    setBody(comments.body)
                   

                    // console.log('comment', comment)

                }


                const deleteArticleComments = () => {

                    doDeleteArticleComments({
                        method: 'delete'
                    })
                }

                useEffect(() => {

                    if (!deleteArticleResponseComments && !isSuccessfull) {
                        return
                    }

                    doFetchComments()
                    setIsSuccesfull(false)
                    setBody('')

                }, [deleteArticleResponseComments, isSuccessfull])





                const isTime = () => {

                    return (
                        new Date(Date.parse(comments.updatedAt))
                    )
                }
                return (
                    <div className='card' key={id}>
                        <div className='card-block'>
                            <p className='card-text'>{comments.body}</p>
                        </div>
                        <div className='card-footer'>
                            <Link to={`/profiles/${fetchArticleResponseComments.comments[id].author.username}`} className='comment-author'>
                                <img src={fetchArticleResponseComments.comments[id].author.image} alt='' className='comment-author-img' />

                            </Link>
                                &nbsp;
                                <Link className='comment-author' to={`/profiles/${fetchArticleResponseComments.comments[id].author.username}`}>{fetchArticleResponseComments.comments[id].author.username}</Link>
                            <span className='date-posted'>{`${isTime()}`}</span>
                            <span className='mod-options' onClick={deleteArticleComments}>
                                <i className='ion-trash-a'></i>
                            </span>
                            <span className='mod-options' onClick={editArticleComments}>
                                <i className='ion-edit'></i>
                            </span>
                        </div>
                    </div>
                )
            })}

        </div>
    )
}

export default Comments