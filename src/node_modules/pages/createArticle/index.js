import React, { useEffect, useState,useContext } from 'react'
import {Redirect} from 'react-router-dom'

import ArticleForm from 'components/articleForm'
import useFetch from 'hooks/useFetch'
import {CurrentUserContext} from 'contexts/currentUser'

const CreateArticle = (props) => {
    const [currentUserState] = useContext(CurrentUserContext)
    const apiURL = '/articles'
    const [{response, error}, doFetch] = useFetch(apiURL)
    // const slug = match.params.slug
    console.log('props',props)
    const initialValues= {
        title: '',
        description: '',
        body: '',
        tagList: []
    }
   

    const [isSuccessfullSubmit,setisSuccessfullSubmit] = useState(false)
    
    const handleSubmit = article => {
        console.log('handleSubmit',article)
        doFetch({
            method: 'post',
            data: {
                article
            }
        })
    }

useEffect(()=> {
    if (!response) {
        return
    }
    setisSuccessfullSubmit(true)
}, [response])

if (!currentUserState.isLogged) {
    return <Redirect to='/'/>
}
 
if(isSuccessfullSubmit) {
         
    return   <Redirect to={`/feed`}/>
}

    return (
        <div>
            <ArticleForm
                errors={(error && error.errors) || {}}
                initialValues={initialValues}
                onSubmit={handleSubmit}
        /></div>
    )
}
export default CreateArticle