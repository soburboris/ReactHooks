import React, {useEffect,useContext, Fragment} from 'react'

import Feed from "components/feed";
import useFetch from 'hooks/useFetch'


import {CurrentUserContext} from 'contexts/currentUser'
import Pagination from 'components/pagination'
import {limit, getPaginator} from 'utility/utuils'

import PopularTags from 'components/popularTags'

import FeedToggler from 'components/feedToggler'


const YourFeed = (props)=> {

const [currentUserState,] = useContext(CurrentUserContext)
const {currentUserName,isLogged} = currentUserState   
const {offset, currentPage} = getPaginator(props.location.search)
 const url = props.match.url

 
const [{response,isLoading,error}, doFetch] = useFetch(`/articles/?author=${currentUserName}&limit=${limit}&offset=${offset}`)


 
    useEffect(() => {
        doFetch()
        
    },[doFetch])
 



   return (
    <React.Fragment>       
            {isLogged &&
             <div className='home-page'>
                 <div className='banner'>
                     <div className='container'>
                         <h1>Medium clone</h1>
                         <p>A place to share knowladge</p>
                     </div>
                 </div>
                 <div className='container page'>
                     <div className='row'>
                         <div className='col-md-9'>
                             <FeedToggler />  
                            
                            {isLoading && <div>Loading...</div>}
                            {error && <div>Sometimes errors happend</div>}
                            {!isLoading && response && 
                            <Fragment>
                                                
                                <Feed articles={response.articles} />
                                 <Pagination total={response.articlesCount}limit={limit} url={url} currentPage={currentPage} />
                                                
                            </Fragment>}
                                
                         </div>
                         <div className='col-md-3'>
                             <PopularTags/>
                         </div>
                     </div>
                 </div>
             </div>
                }

        
         
 
         
    </React.Fragment>
       
)}
export default YourFeed